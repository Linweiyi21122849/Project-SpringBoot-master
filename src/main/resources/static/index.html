<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>题谷</title>
    <meta name="description" content="Charcoal is a free Bootstrap 4 UI kit build by @attacomsian at Wired Dots."/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Bootstrap 4-->
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>

<!--定义一个固定在页面顶部的导航栏，使用Bootstrap类-->
<nav class="navbar navbar-expand-md navbar-dark fixed-top sticky-navigation" id="nav">
    <a class="navbar-brand font-weight-bold" href="#">题谷——高中生做题平台</a>

    <!--            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topMenu" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">-->
    <!--                <span class="navbar-toggler-icon"></span>-->
    <!--            </button>-->

    <div class="collapse navbar-collapse" id="topMenu">

    </div>

    <a class="navbar-brand font-weight-bold" href="index.html">主页</a>
    <a class="navbar-brand font-weight-bold" href="javascript:void(0);" onclick=logout()>注销</a>
</nav>

<!--hero section-->
<section class="bg-hero">
    <div class="container">
        <div class="row vh-100">
            <div class="col-sm-12 my-auto text-center">
                <h1>题谷——高中生做题平台</h1>
                <p class="lead text-capitalize my-4">
                    基于 Java-SpringBoot 搭建的高中生做题平台
                </p>
            </div>
        </div>
    </div>
</section>

<!--components-->
<section class="my-5 pt-5">
    <div class="container">

        <!-- Tables  -->
        <div class="row mb-5" id="tables">
            <div class="col-sm-12">
                <div class="mt-3 mb-5">
                    <h3>题目列表</h3>
                    <table class="table">
                        <thead class="thead-dark">
                        <tr>
                            <th>ID</th>
                            <th>题目</th>
                            <th>难度</th>
                            <th>题目类型</th>
                            <th>作答状态</th>
                        </tr>
                        </thead>
                        <tbody id="problemTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<!--footer-->
<section class="py-5 bg-dark">
    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3 col-sm-8 offset-sm-2 col-xs-12 text-center">
                <!-- <h3>Upgrade to Pro Version</h3>
                <p class="pt-2">
                    We are working on <b>Charcoal Pro</b> which will be released soon. The pro version
                    will have a lot more components, sections, icons, plugins and example pages.
                    Join the waiting list to get notified when we release it (plus discount code).
                </p>
                <a class="btn btn-warning" href="https://wireddots.com/newsletter">Join Waiting List</a>
                <hr class="my-5"/> -->
                <p class="pt-2 text-muted">
                    &copy; 2024
                </p>
            </div>
        </div>
    </div>
</section>

<<<<<<< HEAD
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
<script src="js/app.js"></script>
<script>
    // 在页面加载的时候，尝试从服务器获取题目列表，通过 ajax 的方式来进行获取
    getUserManageMdel();
    function getUserManageMdel() {
        //通过AJAX请求判断用户是否为管理员，如果是，则动态添加管理模块链接到html中的nav模块。
        $.ajax({
            url: "usermanage/isload",
            type: "POST",
            success: function (data, status) {
                if (data.state === 6050) {// 当前用户是管理员用户
                    let a1 = document.createElement("a");
                    a1.href = "userManage.html";
                    a1.innerHTML = "用户信息管理模块";
                    a1.className = "navbar-brand font-weight-bold";
                    let a2 = document.createElement("a");
                    a2.href = "problemManage.html";
                    a2.innerHTML = "题目信息管理模块";
                    a2.className = "navbar-brand font-weight-bold";

                    let nav = document.querySelector("#nav");
                    nav.appendChild(a1);
                    nav.appendChild(a2); //将创建的链接元素添加到导航栏中
                }
                // 如果不是的话，那么是普通用户，就什么都不做
            }
        })
    }

    //通过AJAX请求获取题目列表，并调用makeProblemTable(data)函数生成表格
    function getProblems() {
        // 1. 通过 ajax 从服务器获取到题目列表
        $.ajax({
            url: "oj/problems",
            type: "GET",
            success: function (data, status) {
                makeProblemTable(data);
            },
            error: function () {
                alert("服务器异常，获取题目信息失败!");
            }
        })
    }

    //生成题目列表的HTML片段
    function makeProblemTable(data) {
        // 通过这个函数把数据转换成HTML 片段
        //获取页面中 id 为 problemTable 的 <tbody> 元素
        let problemTable = document.querySelector("#problemTable");
        for (let problem of data) {
            let tr = document.createElement("tr");
            //创建并添加题目 ID 列
            let tdId = document.createElement("td");
            tdId.innerHTML = problem.id;
            tr.appendChild(tdId);
            //创建并添加题目标题列
            let tdTitle = document.createElement("td");
            let a = document.createElement("a");
            a.innerHTML = problem.title;
            //TODO
            a.href = "problemDetail.html?id=" + problem.id;
            a.target = "_blank";
            tdTitle.appendChild(a);
            tr.appendChild(tdTitle);
            // 创建并添加难度列
            let tdLevel = document.createElement("td");
            tdLevel.innerHTML = problem.level;
            tr.appendChild(tdLevel);
            // 创建并添加题目类型列
            let tdtype = document.createElement("td");
            tdtype.innerHTML = problem.type;
            tr.append(tdtype);
            //创建并添加题目状态列
            let tdstates = document.createElement("td");
            // tdstates.innerHTML = problem.states;
            tdstates.innerHTML = "未完成";
            tr.appendChild(tdstates);
            problemTable.appendChild(tr);
        }
    }
    getProblems();

    // 调用AJAX请求进行注销。
    function logout() {
        $.ajax({
            url: "state/logout",
            type: "POST",
            success: function (data, status) {
                //弹出一个警告框，显示服务器返回的消息
                alert(data.message);
                if (data.state === 5002) {
                    location.href = "login.html";
                }
            }
        })
    }

</script>
</body>
</html>
